# ConsoleMonitor / agent / SETUP.md

This file is **for OpenClaw only**.

It focuses on the **cron job** that checks for hanging consoles and notifies via Telegram.

## Canonical locations (relative)

- Runbook: `agent/JOB.md`
- Scripts folder: `scripts/`
- State file: `scripts/consoles.json`
- Status view files (generated by `read.js`): `scripts/<status>.json` (e.g. `scripts/hanging.json`)

## Cron job (every 30 minutes)

### What the job does

Every 30 minutes:

1) Run `node read.js --status hanging` (writes `scripts/hanging.json`).
2) For each entry in `hanging.json`:
   - If it does **not** look like an AI/interactive console => `node ignore.js <pid>`
   - If it **does** look like an AI/interactive console =>
     1) send a **Telegram** notification
     2) `node handle.js <pid>` (ack so we don’t repeatedly alert)

Important:
- Do **not** poke automatically.

### How the cron job finds the project folder

The cron job should not assume a fixed install path.

It should search under the user profile for `*\\console-monitor\\agent\\JOB.md`, then derive:

- `root` = parent of `agent/`
- `scripts` = `root\\scripts`

(See `agent/JOB.md` section “Locate the project”.)

### Telegram delivery

- Prefer OpenClaw `message` tool with `channel=telegram`.
- If the exact chat target isn’t configured, use `action=broadcast` to Telegram.

## Manual follow-up (outside the cron job)

The cron job only detects + notifies + marks handled/ignored. It does **not** poke.

If/when the user later asks to act on a notification:

- **poke**: use the **pid + hash from the notification**

```powershell
# cd to scripts folder first
node poke.js <pid> --hash <sha1> --text "..." --keys "{ENTER}"
```

- **ignore**:

```powershell
# cd to scripts folder first
node ignore.js <pid>
```
